---
title: "Meta-analysis"
author: "P. Melloy"
date: "04/07/2019"
output: html_document
---

# Meta-analysis

## Data-wrangling

```{r Meta_dataImport}
PM_MB_means <- read.csv("data/1902 powdery mildew-Mungbean - Collated means.csv")

str(PM_MB_means)
```


When investigating previous studies into Powdery Mildew Fungicide efficacy on Mungbean `r length(unique(PM_MB_means$Trial_ref))` trials were found, however only eleven Tebeconazol were used for the following meta-analysis, followed by the next common Fungicide Propiconazole. Sulphur was disregarded due to it's inconsistancy in efficacy.

```{r Fungicides}
unique(PM_MB_means$Fungicide)
PM_MB_means %>%
   group_by(Fungicide,Trial_ref) %>%
   summarise() %>%
   count() %>%
   rename(Trials = n) %>%
   kable()

```

### Fungicide Doses
All trials that used Tebeconazole used approimately the same dose. dose of the active ingredient ranged from 62.35 grams per hectare to 60 grams per hectare. 
```{r Tebe_dose}
PM_MB_means %>%
   filter(Fungicide == "Tebeconazole") %>%
   select(Trial_ref, Year, Location, first_sign_disease, Dose.ai.ha., total_Fungicide) %>%
   kable()
```

### Row spacing

Some experiments were designed to investigate the effect of row spacing and plant density on Powdery Mildew disease and crop yield. The results showed that shorter distances between rows increase crop yields and mitigated the yield impact of the disease.  
Seven trials used a row spacing of 0.75 meters.

```{r row_spacing}
PM_MB_means %>%
   filter(Fungicide == "Tebeconazole") %>%
   group_by(row_spacing,Trial_ref) %>%
   summarise() %>%
   count() %>%
   rename(Treatments = n) %>%
   kable()


PM_MB_means %>%
   filter(Fungicide == "Tebeconazole",
          row_spacing == 0.75) 

```


### standardising the type of variance  

The type of variance needs to be standardised between trials and treatments for the meta-analysis. 

```{r variance}
PM_MB_means %>%
   filter(Fungicide == "Tebeconazole",
          row_spacing == 0.75) %>%
   group_by(Y_error.type) %>%
   summarise(n = length(Y_error.type))
   
   
```

```{r LSD_2_SD}
# Formula and modifications based off information found at https://www.statisticshowto.datasciencecentral.com/how-to-calculate-the-least-significant-difference-lsd/
colnames(PM_MB_means)

Tcrit <- 1.697  # 0.05 and DFw = 30 # T critical value for which there is significant difference between two groups
DFw <- sum(PM_MB_means[PM_MB_means$Trial_ref == "mung1112/02",]$Replicates) - 
   length(PM_MB_means[PM_MB_means$Trial_ref == "mung1112/02",]$Replicates) # degrees of freedom within groups
n.A <- PM_MB_means[PM_MB_means$Trial_ref == "mung1112/02",]$Replicates[1]
n.B <- PM_MB_means[PM_MB_means$Trial_ref == "mung1112/02",]$Replicates[1]
LSD <- PM_MB_means[PM_MB_means$Trial_ref == "mung1112/02",]$Yield_error[1]


# SSwithin <- #unknown
# MSW <- SSwithin / DFw # mean square within (SS within / DF within)


#  LSD = (Tcrit) * sqrt(MSW * (1/n.A + 1/n.B))
#  (LSD/Tcrit) = sqrt(MSW * (1/n.A + 1/n.B))
#  (LSD/Tcrit)^2 = MSW * (1/n.A + 1/n.B)
#  (LSD/Tcrit)^2/(1/n.A + 1/n.B) = MSW
MSW <- (LSD/Tcrit)^2/(1/n.A + 1/n.B)

SSquares <- MSW * DFw

Stdev <- sqrt(
   (1/(PM_MB_means[PM_MB_means$Trial_ref == "mung1112/02",]$Replicates[1] - 1)) * 
      SSquares)

```


